{% load static %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap">
<link rel="stylesheet" href="{% static 'hello_world/css/main.css' %}">

<header class="shadow-sm bg-white mb-3 py-3 px-4 d-flex align-items-center justify-content-between header-qlmh">
  <div class="d-flex align-items-center gap-3">
    <img src="{% static 'hello_world/images/icon.gif' %}" alt="Logo" class="logo-qlmh">
    <span class="fs-3 fw-bold text-primary title-qlmh">Quản lý mô hình & Bản đồ</span>
  </div>
</header>
<div class="container mt-2 mb-0 px-0 d-flex justify-content-start">
  <a href="{% url 'hello_world:home' %}" class="btn-home" style="font-family:'Roboto',Arial,sans-serif;">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16" style="margin-right:4px;"><path d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 2 7.5V14a1 1 0 0 0 1 1h3.5a.5.5 0 0 0 .5-.5V11h2v3.5a.5.5 0 0 0 .5.5H13a1 1 0 0 0 1-1V7.5a.5.5 0 0 0-.146-.354l-6-6zM13 14H9.5V11a.5.5 0 0 0-.5-.5h-2a.5.5 0 0 0-.5.5v3H3V7.707l5-5 5 5V14z"/></svg>
    Trang chủ
  </a>
</header>
<div class="container py-4">
  <!-- Nút Trang chủ đã thêm phía trên -->
  <!-- Form thêm mô hình hiển thị cho tất cả người dùng -->
  <div class="add-model-card card-shadow mb-4">
    <div class="add-model-header">
      <span class="add-model-title">Thêm mô hình</span>
    </div>
    <form method="post" action="">
      {% csrf_token %}
      <input type="hidden" name="add_model" value="1">
      <div class="row g-3 align-items-center">
        <div class="col-md-4">
          <label for="ten" class="form-label">Tên mô hình <span class="text-danger">*</span></label>
          <input type="text" class="form-control" id="ten" name="ten" required maxlength="100">
        </div>
        <div class="col-md-4">
          <label for="mo_ta" class="form-label">Mô tả</label>
          <input type="text" class="form-control" id="mo_ta" name="mo_ta" maxlength="255">
        </div>
        <div class="col-md-3">
          <label for="trang_thai" class="form-label">Trạng thái</label>
          <select class="form-select" id="trang_thai" name="trang_thai">
            <option value="active">Đang hoạt động</option>
            <option value="inactive">Ngừng</option>
          </select>
        </div>
        <div class="col-md-1 d-flex align-items-end">
          <button type="submit" class="btn btn-primary btn-block add-model-btn">Thêm</button>
        </div>
      </div>
      {% if form_error %}
        <div class="form-error mt-2">{{ form_error }}</div>
      {% endif %}
    </form>
  </div>
  <!-- Bảng danh sách mô hình -->
  <div class="model-list-card card-shadow">
    <div class="model-list-header">
      <span class="model-list-title">Danh sách mô hình</span>
    </div>
    <div class="table-responsive custom-table-scroll">
  <table class="model-table styled-table table table-hover align-middle mb-0 custom-min-width table-dashboard">
        <thead>
          <tr>
            <th>ID</th>
            <th>Tên</th>
            <th>Mô tả</th>
            <th>Thời gian</th>
            <th>Cập nhật</th>
            <th>Trạng thái</th>
            <th>Hành động</th>
          </tr>
        </thead>
        <tbody>
          {% for mh in ds_mo_hinh %}
          {% if edit_id and edit_id|add:'' == mh.id|stringformat:'s' %}
          <tr class="bg-light">
            <form method="post">
              {% csrf_token %}
              <input type="hidden" name="edit_model_id" value="{{ mh.id }}">
              <td class="text-center">{{ mh.id }}</td>
              <td><input type="text" name="ten" class="form-control form-control-sm" value="{{ edit_form.ten.value|default:mh.ten }}" maxlength="100" required></td>
              <td><input type="text" name="mo_ta" class="form-control form-control-sm" value="{{ edit_form.mo_ta.value|default:mh.mo_ta }}" maxlength="255"></td>
              <td>{{ mh.thoi_gian|default_if_none:'' }}</td>
              <td>{{ mh.thoi_gian_cap_nhat|default_if_none:'' }}</td>
              <td>
                <select name="trang_thai" class="form-select form-select-sm">
                  <option value="active" {% if edit_form.trang_thai.value == 'active' or mh.trang_thai == 'active' %}selected{% endif %}>Đang hoạt động</option>
                  <option value="inactive" {% if edit_form.trang_thai.value == 'inactive' or mh.trang_thai == 'inactive' %}selected{% endif %}>Ngừng</option>
                </select>
              </td>
              <td class="text-center">
                <button type="submit" class="btn btn-success btn-sm rounded-3 px-3 me-1">Lưu</button>
                <a href="?" class="btn btn-secondary btn-sm rounded-3 px-3">Huỷ</a>
              </td>
            </form>
          </tr>
          {% else %}
          <tr>
            <td class="text-center">{{ mh.id }}</td>
            <td>{{ mh.ten }}</td>
            <td>{{ mh.mo_ta }}</td>
            <td>{{ mh.thoi_gian|default_if_none:'' }}</td>
            <td>{{ mh.thoi_gian_cap_nhat|default_if_none:'' }}</td>
            <td class="text-center">{% if mh.trang_thai == 'active' %}<span class="status-active">Đang hoạt động</span>{% else %}<span class="status-inactive">Ngừng</span>{% endif %}</td>
            <td class="text-center">
              <a href="?edit_id={{ mh.id }}" class="btn btn-warning btn-sm rounded-3 px-3 me-1">Sửa</a>
              <form action="{% url 'hello_world:admin_xoa_mo_hinh' mh.id %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-sm rounded-3 px-3" onclick="return confirm('Bạn có chắc muốn xoá mô hình này?');">Xoá</button>
              </form>
            </td>
          </tr>
          {% endif %}
          {% empty %}
          <tr><td colspan="7" class="text-center text-muted">Không có dữ liệu mô hình.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
